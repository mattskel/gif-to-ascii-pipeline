<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      body {
        font-family: "Courier New", Courier, monospace;
        white-space: pre-wrap;
        background: black;
        color: white;
        font-size: 0.5em;
      }
    </style>
  </head>
  <body>
    <div>
      <form id="myForm">
        <input type="text" name="searchTerm" autocomplete="off" /><button>Send</button>
      </form>  
      <div id="whereTheTextGoes"></div>
      <img id="image" src="" alt="PNG Image">
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      // var socket = io();
      var textArea = document.getElementById('whereTheTextGoes');
      var imgElement = document.getElementById('image');
      var myForm = document.getElementById('myForm');

      myForm.addEventListener('submit', function(event) {
        event.preventDefault();
        // const httpRequest = new XMLHttpRequest();
        // httpRequest.open('GET', '/submit', true);
        // httpRequest.send({query: {searchTerm: 'cat'}})
        fetch('/submit', {
          method: 'GET',
          // body: JSON.stringify({searchTerm: 'cat'}),
          query: {searchTerm: 'cat'},
        })
          .then((response) => response.body)
          .then((body) => {
            const reader = body.getReader();

            function readStream() {
              return reader.read().then(({ done, value }) => {
                // Check if the stream has ended
                if (done) {
                  console.log("Streaming complete.");
                  return;
                }
                // console.log('value', value);
                // Convert buffer to ascii text
              
                textArea.innerHTML = frame;

                // Continue reading the stream
                return readStream();
              });
            }

            // Start reading the streamed data
            return readStream();
          })

      })

      // socket.on('frame', (frame) => {
      //   textArea.innerHTML = frame;
      // });

      // socket.on('colorFrame', (url) => {
      //   console.log('colorFrame');
      //   imgElement.src = url;
      // });
    </script>
  </body>
</html>